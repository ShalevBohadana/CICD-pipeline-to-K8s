# ğŸš€ CI/CD Pipeline to Kubernetes

[![Terraform](https://img.shields.io/badge/Terraform-1.4+-623CE4?logo=terraform\&logoColor=white)](https://www.terraform.io/)
[![AWS](https://img.shields.io/badge/AWS-EKS-232F3E?logo=amazonaws\&logoColor=white)](https://aws.amazon.com/eks/)
[![Jenkins](https://img.shields.io/badge/Jenkins-LTS-D24939?logo=jenkins\&logoColor=white)](https://www.jenkins.io/)
[![GitOps](https://img.shields.io/badge/GitOps-ArgoCD-149DDD?logo=argo)](https://argoproj.github.io/argo-cd/)

> An **opinionated**, end-to-end CI/CD pipeline deploying a Node.js sample app to AWS EKS.
> Infrastructure defined in Terraform, build & delivery via Jenkins, and GitOps with Argo CD.

---

## ğŸŒ² Repository Layout

```text
ğŸ“¦ ci-cd-pipeline-to-k8s
â”œâ”€â”€ ğŸ“‚ app/                    # Node.js â€œHello Worldâ€ service
â”‚   â”œâ”€â”€ Dockerfile
â”‚   â””â”€â”€ src/index.js          # Simple Express server
â”œâ”€â”€ ğŸ“‚ k8s/                    # Kubernetes manifests (YAML)
â”‚   â”œâ”€â”€ deployment.yaml
â”‚   â””â”€â”€ service.yaml
â”œâ”€â”€ ğŸ“‚ infra/                  # Terraform infrastructure
â”‚   â”œâ”€â”€ ğŸ“‚ state/              # Terraform remoteâ€state (S3 & DynamoDB)
â”‚   â”œâ”€â”€ ğŸ“‚ bootstrap/          # IAM role bootstrap for Terraform/Jenkins
â”‚   â”œâ”€â”€ ğŸ“‚ modules/            # Reusable modules: vpc, eks, ecr, jenkins
â”‚   â”œâ”€â”€ backend.hcl            # Remoteâ€state config
â”‚   â”œâ”€â”€ providers.tf           # AWS provider (assume-role for CI)
â”‚   â”œâ”€â”€ main.tf                # Root module orchestration
â”‚   â”œâ”€â”€ variables.tf           # Root variables
â”‚   â”œâ”€â”€ locals.tf              # Common locals (tags, naming)
â”‚   â””â”€â”€ outputs.tf             # Exposed outputs
â”œâ”€â”€ ğŸ“„ Jenkinsfile             # Jenkins pipeline definition
â””â”€â”€ ğŸ“„ README.md               # Project overview
```

---

## ğŸ›  Prerequisites

* **AWS CLI** configured with appropriate permissions
* **Terraform v1.4+** installed
* **kubectl** (configured after EKS cluster creation)
* **Java & Jenkins** (for your CI server)

---

## âš™ï¸ Getting Started

### 1. Bootstrap Remote State

```bash
cd infra/state
terraform init
terraform apply -auto-approve
```

*Provision S3 bucket & DynamoDB table for shared state.*

---

### 2. Bootstrap Execution Role

```bash
cd ../bootstrap
terraform init -backend-config="../backend.hcl"
terraform apply -auto-approve
```

*Create the `TerraformInfraRole` and instance profile for CI / EC2.*

---

### 3. Deploy Core Infrastructure

```bash
cd ../
# Paste the bootstrap role ARN into infra/variables.tf â†’ bootstrap_role_arn
terraform init -backend-config="backend.hcl" -reconfigure
terraform plan
terraform apply -auto-approve
```

*Provisions VPC, EKS cluster, ECR repo, and Jenkins server.*

---

### 4. Configure kubectl for EKS

```bash
aws eks update-kubeconfig --region <AWS_REGION> --name <CLUSTER_NAME>
kubectl get nodes -n production
```

*Verify your nodes are ready in the â€œproductionâ€ namespace.*

---

### 5. Deploy the Sample App

```bash
cd k8s
kubectl apply -f deployment.yaml
kubectl apply -f service.yaml
```

*Your â€œHello Worldâ€ app will run behind a LoadBalancer service.*

---

## ğŸ“ˆ CI/CD Pipeline

1. **Source**: GitHub pushes â†’ Jenkins
2. **Build**: Docker image built & tagged `latest`
3. **Publish**: Image pushed to AWS ECR
4. **Infra**: Terraform plan & apply (if infra changes)
5. **GitOps**: Jenkins commits updated k8s manifests â†’ Argo CD sync

*Jenkinsfile* orchestrates all stages, and Argo CD ensures the cluster state matches Git.

---

## ğŸ“š Next Steps & Roadmap

* [ ] Install and configure **Argo CD** in EKS
* [ ] Add **Horizontal Pod Autoscaler** for sample-app
* [ ] Secure Jenkins behind an **Application Load Balancer** + IAM auth
* [ ] Implement **unit and integration tests** in the Jenkins pipeline
* [ ] Configure **monitoring & alerts** (Prometheus + Grafana)

---

> âš ï¸ **Work in Progress**
> This README and the accompanying Terraform & CI/CD setup are ongoingâ€”expect updates and improvements!

---

> *Crafted by Shalev Bohadana as a portfolio project demonstrating enterprise-grade DevOps practices.*
